---
import { useTranslations } from '../i18n/translations';
const t = useTranslations(Astro.currentLocale);
---

<div class="max-w-xs mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">{t('title')}</h1>
  
  <div class="bg-white rounded-lg shadow p-4">
    <input type="text" id="display" class="w-full p-2 text-right text-xl mb-4 border rounded" readonly />
    
    <div class="grid grid-cols-4 gap-2">
      <button class="calc-btn col-span-2">{t('clear')}</button>
      <button class="calc-btn">←</button>
      <button class="calc-btn">÷</button>
      
      <button class="calc-btn">7</button>
      <button class="calc-btn">8</button>
      <button class="calc-btn">9</button>
      <button class="calc-btn">×</button>
      
      <button class="calc-btn">4</button>
      <button class="calc-btn">5</button>
      <button class="calc-btn">6</button>
      <button class="calc-btn">-</button>
      
      <button class="calc-btn">1</button>
      <button class="calc-btn">2</button>
      <button class="calc-btn">3</button>
      <button class="calc-btn">+</button>
      
      <button class="calc-btn">0</button>
      <button class="calc-btn">.</button>
      <button class="calc-btn col-span-2">{t('equals')}</button>
    </div>
  </div>
</div>

<style>
.calc-btn {
  @apply p-4 text-lg border rounded hover:bg-gray-100 active:bg-gray-200;
}
</style>

<script>
let display = document.getElementById('display') as HTMLInputElement;
let currentNumber = '';
let storedNumber = '';
let operation = '';
let lastResult = '';

function updateDisplay(value: string) {
  if (display) display.value = value;
}

function calculate() {
  const num1 = parseFloat(storedNumber);
  const num2 = parseFloat(currentNumber);
  
  let result = 0;
  switch(operation) {
    case '+': result = num1 + num2; break;
    case '-': result = num1 - num2; break;
    case '×': result = num1 * num2; break;
    case '÷': result = num1 / num2; break;
  }
  
  lastResult = result.toString();
  currentNumber = lastResult;
  storedNumber = '';
  operation = '';
  updateDisplay(lastResult);
}

document.querySelectorAll('.calc-btn').forEach(button => {
  button.addEventListener('click', () => {
    const value = button.textContent || '';
    
    if ('0123456789.'.includes(value)) {
      currentNumber += value;
      updateDisplay(currentNumber);
    }
    else if ('+-×÷'.includes(value)) {
      storedNumber = currentNumber || lastResult;
      operation = value;
      currentNumber = '';
    }
    else if (value === '=') {
      if (storedNumber && currentNumber && operation) {
        calculate();
      }
    }
    else if (value === '←') {
      currentNumber = currentNumber.slice(0, -1);
      updateDisplay(currentNumber);
    }
    else if (value === 'C') {
      currentNumber = '';
      storedNumber = '';
      operation = '';
      lastResult = '';
      updateDisplay('');
    }
  });
});
</script>
